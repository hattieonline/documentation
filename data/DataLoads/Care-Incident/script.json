[
    {
        "App":  "Care-Incident",
        "Section":  "dim_ date",
        "LoadScriptContent":  [
                                  "///$tab dim_ date",
                                  "//\tload only the date field from our fact table. name it to a new field",
                                  "temp:",
                                  "load [%DateKey] as RangeDate\t//\tsource field should be the m/d/yyyy field from your fact table.",
                                  "resident  [fact_table];",
                                  "",
                                  "//\tMinMaxDate finds the lowest and highest dates from the dates.",
                                  "//\tThis has been proven to work much faster than a typical group by on your transaction table.",
                                  "MinMaxDate:  ",
                                  "load min(RangeDate) as MinDate,  ",
                                  "\tmax(RangeDate) as MaxDate;  ",
                                  "load fieldvalue(\u0027RangeDate\u0027,iterno()) as RangeDate ",
                                  "autogenerate(1) while not isnull(fieldvalue(\u0027RangeDate\u0027,iterno()));  ",
                                  " ",
                                  "drop table temp;\t//\tno need to retain",
                                  "",
                                  "let varMinDate=date(peek(\u0027MinDate\u0027,0,\u0027MinMaxDate\u0027));",
                                  "let varMaxDate=date(peek(\u0027MaxDate\u0027,0,\u0027MinMaxDate\u0027));",
                                  "",
                                  "drop table MinMaxDate;\t//\tno need to retain",
                                  "",
                                  "dim_date:",
                                  "LOAD\tMonthYear, ",
                                  "\t\tWeekStart(%DateKey) as WeekStart, ",
                                  "        QuarterStart(%DateKey) as QuarterStart,",
                                  "        %DateKey,",
                                  "        DayName,",
                                  "    //    if(%DateKey - 90 \u003e= Today(), 1, 0) as T90Flg,",
                                  "        if(WeekStart(%DateKey) = WeekStart(Today()), 1, 0) as CurrentWeekFlg",
                                  "",
                                  "FROM [lib://DataShare/QVD Extract\\QVD_Extract_dimDate.qvd]",
                                  "(qvd)where EffectiveDT \u003e=\u0027$(varMinDate)\u0027 and EffectiveDT \u003c=\u0027$(varMaxDate)\u0027;",
                                  "",
                                  "exit script;"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "fact_table Incident",
        "LoadScriptContent":  [
                                  "///$tab fact_table Incident",
                                  "flg:",
                                  "LOAD",
                                  "    IncidentID,",
                                  "    FallFlg as Fall,",
                                  "    MedicationErrorFlg as [Medication Error],",
                                  "    AbuseFlg as Abuse,",
                                  "    PropertyFlg as Property,",
                                  "    ExposureFlg as Exposure,",
                                  "    BehaviorFlg as Behavior,",
                                  "    ElopementFlg as Elopement,",
                                  "    AccidentFlg as Accident,",
                                  "    InjuryFlg as Injury,",
                                  "    IllnessFlg as Illness,",
                                  "    UntypedFlg as Untyped",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_mstrIncident.qvd]",
                                  "(qvd);",
                                  "",
                                  "final_flg: CrossTable (IncidentType, IncidentTypeFlg) LOAD * Resident flg;",
                                  "",
                                  "Outcome:",
                                  "LOAD",
                                  "    IncidentID,",
                                  "    OutcomeDeathFlg as Death,",
                                  "    OutcomeHospitalFlg as Hospital,",
                                  "    OutcomeUnconsciousFlg as Unconscious,",
                                  "    OutcomeAdverseDrugFlg as [Adverse Drug],",
                                  "    OutcomeNoMedicalTreatmentFlg as [No Medical Treatment],",
                                  "    OutcomeMedicalTreatmentFlg as [Medical Treatment],",
                                  "    OutcomeFirstAidFlg as [First Aid],",
                                  "    OutcomeAdverseFamilyReactionFlg as [Adverse Family Reaction],",
                                  "    OutcomeResidentRefusedTreatmentFlg as [Resident Refused Treatment],",
                                  "    OutcomeOtherFlg as [Other],",
                                  "    OutcomeEMSFlg as [EMS],",
                                  "    OutcomeEMTTransportFlg as [EMS Transport],",
                                  "    OutcomeFamilyTransportFlg as [Family Transport],",
                                  "    OutcomePendingFlg as [Outcome Pending]",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_mstrIncident.qvd]",
                                  "(qvd);",
                                  "",
                                  "final_outcome: CrossTable (Outcome, OutcomeFlg) LOAD * Resident Outcome;",
                                  "",
                                  "DROP TABLES Outcome, flg;",
                                  "fact_incident_temp:",
                                  "LOAD    %CustomerIDKey,",
                                  "        %CommunityKey,",
                                  "        \u0027Incident\u0027 as FactType,",
                                  "        IncidentID,     ",
                                  "        IncidentTM,",
                                  "        IncidentHour,",
                                  "        IncidentDTandTime,",
                                  "        IncidentShift,",
                                  "      //  IncidentReportDateTime,",
                                  "        IncidentType as IsStateReportable,",
                                  "        IncidentPriority,",
                                  "        IncidentStatus,",
                                  "        %DateKey,",
                                  "       IF(%DateKey \u003e= Today() - 90, 1, 0) as T90Flg,",
                                  "       IF(%DateKey \u003e= Today() - 30, 1, 0) as T30Flg,",
                                  "       IF(%DateKey \u003e= Today() - 60, 1, 0) as T60Flg,",
                                  "       IF(%DateKey \u003e= Today() - 30, \u0027T30\u0027, ",
                                  "       IF(%DateKey \u003e= Today() - 60 and %DateKey \u003c Today() - 30, \u0027T30-T60\u0027, ",
                                  "       IF(%DateKey \u003e= Today() - 90 and %DateKey \u003c Today() - 60, \u0027T60-T90\u0027))) as TimePeriod,",
                                  "  \t// Eliminate negative average report times ",
                                  "       IF(IncidentReportDateTime - IncidentDTandTime \u003c 0, IncidentReportDateTime - (IncidentReportDateTime - IncidentDTandTime), ",
                                  "       \t\tIncidentReportDateTime) as IncidentReportDateTime,",
                                  "        1 as IncidentFlg        ",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_mstrIncident.qvd] (qvd)",
                                  "WHERE MonthStart(%DateKey) \u003c\u003e MonthStart(Today()) OR EVEN(RIGHT(IncidentID, 1)) = 0 ;",
                                  "",
                                  "LEFT JOIN (fact_incident_temp) LOAD * resident final_outcome where OutcomeFlg = 1;",
                                  "LEFT JOIN (fact_incident_temp) LOAD * resident final_flg  where IncidentTypeFlg = 1;",
                                  "",
                                  "LEFT JOIN (fact_incident_temp) LOAD IncidentID, Concat(DISTINCT IncidentType, \u0027, \u0027) as IncidentTypeMulti Resident fact_incident_temp GROUP BY IncidentID;",
                                  "LEFT JOIN (fact_incident_temp) LOAD IncidentID, Concat(DISTINCT Outcome, \u0027, \u0027) as OutcomeMulti Resident fact_incident_temp GROUP BY IncidentID;",
                                  "",
                                  "DROP TABLES final_flg, final_outcome;"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "final_fact   mstrRentRoll",
        "LoadScriptContent":  [
                                  "///$tab final_fact / mstrRentRoll",
                                  "fact_table: NoConcatenate LOAD * Resident fact_incident_temp;",
                                  "",
                                  "LEFT JOIN (fact_table)",
                                  "LOAD",
                                  "    CMSResidentDashboard,",
                                  "    RMSLeaseManagement,",
                                  "    %CustomerIDKey,",
                                  "    %CommunityKey,",
                                  "    \"Resident\",",
                                  "    RoomNumber,",
                                  "    PayorType,",
                                  "    CurrentRent,",
                                  "    RoomTypeStyleCode,",
                                  "    AssessedCareRate,",
                                  "    AssessedMedRate,",
                                  "    IsPhysicalPresentFlg,",
                                  "    AssessedCareType,",
                                  "    AssessedCareLevel,",
                                  "    AssessedMedLevel,",
                                  "    Status,",
                                  "    Date(Floor(MoveInDt)) as MoveInDT,",
                                  "    IF(MoveInDt \u003e= MonthStart(AddMonths(Today(), -1)), 1, 0) as NewMoveInFlg,",
                                  "\tTrim(Subfield(\"Resident\", \u0027,\u0027, 2))\u0026\u0027 \u0027\u0026Subfield(\"Resident\", \u0027,\u0027, 1) as ResidentName,",
                                  "    ScheduledMoveOutDT,",
                                  "    Gender,",
                                  "    IF(Month(DOB) = Month(Today()), 1, 0) as UpcomingBirthdayFlg,",
                                  "    Age(Today(), DOB) as Age,",
                                  "    DOB,",
                                  "    BilledCareType,",
                                  "    BilledCareLevel",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_mstrRentRoll.qvd]",
                                  "(qvd);",
                                  "",
                                  "DROP TABLES fact_incident_temp;"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "Main",
        "LoadScriptContent":  [
                                  "///$tab Main",
                                  "SET ThousandSep=\u0027,\u0027;",
                                  "SET DecimalSep=\u0027.\u0027;",
                                  "SET MoneyThousandSep=\u0027,\u0027;",
                                  "SET MoneyDecimalSep=\u0027.\u0027;",
                                  "SET MoneyFormat=\u0027$#,##0.00;-$#,##0.00\u0027;",
                                  "SET TimeFormat=\u0027h:mm:ss TT\u0027;",
                                  "SET DateFormat=\u0027M/D/YYYY\u0027;",
                                  "SET TimestampFormat=\u0027M/D/YYYY h:mm:ss[.fff] TT\u0027;",
                                  "SET FirstWeekDay=6;",
                                  "SET BrokenWeeks=1;",
                                  "SET ReferenceDay=0;",
                                  "SET FirstMonthOfYear=1;",
                                  "SET CollationLocale=\u0027en-US\u0027;",
                                  "SET MonthNames=\u0027Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec\u0027;",
                                  "SET LongMonthNames=\u0027January;February;March;April;May;June;July;August;September;October;November;December\u0027;",
                                  "SET DayNames=\u0027Mon;Tue;Wed;Thu;Fri;Sat;Sun\u0027;",
                                  "SET LongDayNames=\u0027Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday\u0027;",
                                  "SET NumericalAbbreviation=\u00273:k;6:M;9:G;12:T;15:P;18:E;21:Z;24:Y;-3:m;-6:??;-9:n;-12:p;-15:f;-18:a;-21:z;-24:y\u0027;",
                                  "",
                                  "//Variables for Task load",
                                  "LET vmindatetrailingtasks = date(Today());",
                                  "LET vmaxdatetrailingtasks = date(floor(today()-7));"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "mstrCommunity",
        "LoadScriptContent":  [
                                  "///$tab mstrCommunity",
                                  "mstrCommunity:",
                                  "LOAD",
                                  "    %CommunityKey,",
                                  "    CommunityID,",
                                  "    CommunityName,",
                                  "    Division,",
                                  "    SVP,",
                                  "    Region,",
                                  "    RVP,",
                                  "    CommunityState,",
                                  "    CommunityCountry",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_mstrCommunity.qvd]",
                                  "(qvd);",
                                  "",
                                  "LEFT JOIN (mstrCommunity) ",
                                  "LOAD",
                                  "    Count(DISTINCT CustomerID) as NoOfResidents,",
                                  "    CommunityNumber as %CommunityKey",
                                  "FROM [lib://DataShare/QVD Extract/QVD_Extract_mstrCustomer.qvd] (qvd)",
                                  "WHERE Match(StatusID, 6, 7, 9, 11,8)",
                                  "GROUP BY CommunityNumber;"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "Section Access",
        "LoadScriptContent":  [
                                  "///$tab Section Access",
                                  "SecurityTEMP:",
                                  "LOAD",
                                  "    \"ACCESS\",",
                                  "    \"USERID\",",
                                  "    COMMUNITYNUMBER",
                                  "FROM [lib://DataShare/QVD Transform/QVD_Transform_SectionAccess.qvd]",
                                  "(qvd);",
                                  "",
                                  "Section Access;",
                                  "",
                                  "Security:",
                                  "NoConcatenate",
                                  "LOAD",
                                  "    \"ACCESS\",",
                                  "    \"USERID\",",
                                  "    COMMUNITYNUMBER",
                                  "Resident SecurityTEMP;",
                                  "",
                                  "Section Application;",
                                  "",
                                  "Drop Table SecurityTEMP;"
                              ]
    },
    {
        "App":  "Care-Incident",
        "Section":  "tab_order.txt",
        "LoadScriptContent":  [
                                  "Main%tab_file_order_divider%Section Access%tab_file_order_divider%mstrCommunity%tab_file_order_divider%fact_table Incident%tab_file_order_divider%final_fact   mstrRentRoll%tab_file_order_divider%dim_ date"
                              ]
    }
]
